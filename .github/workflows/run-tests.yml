name: Run iOS Tests (PR)

on:
  pull_request:
    branches:
      - develop
      - main
  push:
    branches:
      - develop

jobs:
  build-and-test:
    name: Build and Test iOS Project
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: latest-stable

      - name: Boot iPhone Simulator
        run: |
          # Inicializar um simulador espec√≠fico
          xcrun simctl boot "iPhone 16 Pro"
          
          # Verificar se inicializou corretamente
          xcrun simctl list devices | grep "iPhone 16 Pro"

      - name: Run Tests
        run: |
          xcodebuild \
            -scheme td-tests \
            -destination 'platform=iOS Simulator,name=iPhone 16 Pro,OS=18.4' \
            clean test

      - name: Shutdown Simulator
        if: always()
        run: |
          xcrun simctl shutdown "iPhone 16 Pro"
